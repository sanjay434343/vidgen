<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Video Export</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui;
  padding:20px;
}
.app{
  max-width:420px;
  margin:auto;
}
canvas{
  width:100%;
  aspect-ratio:9/16;
  background:#000;
  border-radius:14px;
}
button{
  width:100%;
  margin-top:10px;
  padding:12px;
  font-weight:800;
  background:#2563eb;
  color:#fff;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="app">
  <canvas id="canvas"></canvas>
  <button onclick="renderAndRecord()">ðŸŽ¬ Generate Video</button>
</div>

<script>
/* ================== CONFIG ================== */
const FPS = 30;

/* Replace this with fetch('/api/ai-video') result */
const VIDEO_DATA = YOUR_API_JSON_RESPONSE;

/* ============================================ */

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = VIDEO_DATA.width;
canvas.height = VIDEO_DATA.height;

/* ---------- Load Audio ---------- */
const audio = new Audio(VIDEO_DATA.audio);

/* ---------- Render SVG to Canvas ---------- */
function drawSVG(svg){
  return new Promise(res=>{
    const img = new Image();
    img.onload = ()=>{
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      res();
    };
    img.src = "data:image/svg+xml;base64," +
      btoa(unescape(encodeURIComponent(svg)));
  });
}

/* ---------- Main Render + Record ---------- */
async function renderAndRecord(){
  const stream = canvas.captureStream(FPS);
  const audioStream = audio.captureStream();

  audioStream.getTracks().forEach(t=>stream.addTrack(t));

  const recorder = new MediaRecorder(stream, {
    mimeType: "video/webm; codecs=vp9"
  });

  const chunks = [];
  recorder.ondataavailable = e => chunks.push(e.data);

  recorder.start();
  audio.play();

  for (const frame of VIDEO_DATA.frames){
    const frameCount = frame.duration * FPS;
    for (let i=0;i<frameCount;i++){
      await drawSVG(frame.svg);
      await wait(1000/FPS);
    }
  }

  recorder.stop();

  recorder.onstop = ()=>{
    const blob = new Blob(chunks,{type:"video/webm"});
    download(blob,"ai-video.webm");
  };
}

function wait(ms){
  return new Promise(r=>setTimeout(r,ms));
}

function download(blob,name){
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
}
</script>

</body>
</html>
